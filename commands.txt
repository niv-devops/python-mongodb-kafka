# Create virtual environment
sudo apt install python3-venv
python3 -m venv .venv
source .venv/bin/activate

# Install requirments
pip install flask kafka-python pymongo

# Start the ZooKeeper server
bin/zookeeper-server-start.sh config/zookeeper.properties

# Start the Kafka server (On another terminal)
bin/kafka-server-start.sh config/server.properties

# Build docker images to API and Client servers & Push them to Docker Hub
eval $(minikube docker-env)
docker build -t kafka-python:latest .
docker tag kafka-python:latest devopsgoofy/kafka-python:latest
docker push devopsgoofy/kafka-python:latest


# Apply the cluster
kubectl create namespace python-mongodb
kubectl apply -f k8s-manifests/ --namespace=python-mongodb
kubectl get pods
minikube ip

# Setup mongodb
kubectl exec -it -n python-mongodb <mongodb-pod-name> -- bash
mongosh
use broncos;
db.createCollection("customers");
db.createCollection("items");
###
db.items.insertMany([
    { "item": "Blue Jersey", "price": 80, image: 'https://cdn.jerseyaz.com/wp-content/uploads/2024/04/gexdimzsguAdgmjugCAtmnrxgexdambqgaxdkmjrgaAdqmrwgCxtkmztgexdknjt-510x510.jpeg' },
    { "item": "Orange Jersey", "price": 90, image: 'https://fanatics.frgimages.com/denver-broncos/youth-denver-broncos-peyton-manning-nike-orange-team-color-game-jersey_pi787000_altimages_ff_787747alt1_full.jpg?_hv=2&w=900' },
    { "item": "White Jersey", "price": 100, image: 'https://fanatics.frgimages.com/denver-broncos/youth-denver-broncos-peyton-manning-nike-white-game-jersey_pi787000_altimages_ff_787753alt1_full.jpg?_hv=2&w=900' }
]);
###
db.customers.insertMany([
    { "username": "niv", "password": "admin", "Blue Jersey": 0, "Orange Jersey": 0, "White Jersey": 0 }
]);
###
show dbs
db.items.find()
db.customers.find()
exit

# Helm charts
helm create kafka-mongo-chart
helm dependency update
helm install kafka-mongo-chart . --namespace chart-python-mongodb --create-namespace
helm status kafka-mongo-chart --namespace chart-python-mongodb